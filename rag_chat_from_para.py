# -*- coding: utf-8 -*-
"""RAG-chat from para

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1N96jFyZDC4T8PmfFCFX1d6PlWMJCyr4n
"""

!pip install langchain==0.3.19 langchain-openai==0.3.7 langchain-community==0.3.18 langchain-text-splitters==0.3.6 faiss-cpu==1.10.0 beautifulsoup4==4.13.3 openai==1.64.0 python-dotenv==1.0.1

# 1. Split Text
import os
os.environ["USER_AGENT"] = "MyLangChainApp/1.0"
from langchain_text_splitters import RecursiveCharacterTextSplitter
splitter = RecursiveCharacterTextSplitter(chunk_size=300, chunk_overlap=50)
docs = splitter.create_documents (["""What is the 5-Day AI Agents Intensive? The 5-Day AI Agents Intensive course with Google is a hands-on program originally held live from November 10 - 14, 2025. It is now available as a self-paced Kaggle Learn guide so anyone can explore the foundations, architecture and practical development of AI agents.This course was crafted by Google’s ML researchers and engineers to help developers explore the foundations and practical applications of AI agents. You’ll learn the core components – models, tools, orchestration, memory and evaluation. Finally, you’ll discover how agents move beyond LLM prototypes to become production-ready systems.        Each day blends conceptual deep dives with hands-on examples, codelabs, and live discussions. By the end, you’ll be ready to build, evaluate, and deploy agents that solve real-world problems.Welcome to our Agents Intensive Learn Guide!Other ResourcesWhat’s being covered?Day 1 - Introduction to Agents: Explore the foundational concepts of AI agents, their defining characteristics, and how agentic architectures differ from traditional LLM applications, laying the groundwork for building intelligent, autonomous systems.Day 2 - Agent Tools & Interoperability with Model Context Protocol (MCP): Dive into the world of tools, understanding how AI agents can "take action" by leveraging external functionalities and APIs, and explore the ease of discovering and using tools offered by the MCP.Day 3 - Context Engineering: Sessions & Memory: Explore how to build AI agents that can remember past interactions and maintain context. Learn how to implement short-term and long-term memory to create more robust agents capable of handling complex, multi-turn tasks.Day 4 - Agent Quality: Learn to build robust and reliable AI agents by mastering the critical disciplines of evaluating and improving agents. This session will cover observability, logging, and tracing to provide visibility, alongside key metrics and evaluation strategies to optimize agent performance.Day 5 - Prototype to Production: Go beyond local testing and learn to deploy and scale AI agents for real-world use. This session will cover the best practices for deploying your agents so that others can use them, including how to create a truly multi-agent system with the Agent2Agent (A2A) Protocol."""])

for i, doc in enumerate(docs):
    print(f"--- Document {i+1} ---")
    print(doc.page_content)
    print("\n")

# 2. Vector Store
import os
from dotenv import load_dotenv
from google.colab import userdata

# Load environment variables from .env file (if present)
load_dotenv()

# Load API key from Colab Secrets if available, otherwise check .env or raise error
if "OPENAI_API_KEY" not in os.environ:
    try:
        os.environ["OPENAI_API_KEY"] = userdata.get("OPENAI_API_KEY")
    except userdata.SecretNotFoundError:
        raise ValueError("OPENAI_API_KEY not found. Please set it as a Colab Secret or in your .env file.")

from langchain_community.vectorstores import FAISS
from langchain_openai import OpenAIEmbeddings
# Correctly initialize FAISS from documents
vector_store = FAISS.from_documents(docs, OpenAIEmbeddings())

query = "agentic architecture"
docs_found = vector_store.similarity_search(query)

print(f"Found {len(docs_found)} relevant documents for the query: '{query}'")
for i, doc in enumerate(docs_found):
    print(f"--- Document {i+1} ---")
    print(doc.page_content)
    print("\n")

# 3. Retriever
retriever = vector_store.as_retriever()

print(retriever)

# 4. Prompt
from langchain_core.prompts import ChatPromptTemplate
template = ChatPromptTemplate.from_messages([
    ("system", "Answer based on the context: {agent}"),
    ("human", "{question}")
])

print(template)

from langchain_openai import ChatOpenAI
from langchain_core.runnables import RunnablePassthrough
from langchain_core.output_parsers import StrOutputParser

llm = ChatOpenAI(model="gpt-4o-mini")

rag_chain = (
    {"agent": retriever, "question": RunnablePassthrough()}
    | template
    | llm
    | StrOutputParser()
)

question_to_ask = "What is the 5-Day AI Agents Intensive?"
response = rag_chain.invoke(question_to_ask)
print(response)